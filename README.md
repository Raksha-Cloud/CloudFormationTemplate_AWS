# webapp Assignment - 03
## AWS IAM setup and Cloudformation template


<table>
    <thead>
      <tr>
        <th>Name</th>
        <th>NUID</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td>Raksha Kagadalu Raju</td>
            <td>002920092</td>
        </tr>
    </tbody>
</table>


### 1. Objective
To set up our AWS infrastructure. This assignment will focus on setting up our networking resources such as Virtual Private Cloud (VPC), Internet Gateway, Route Tables, and Routes. We will use AWS CloudFormation for infrastructure setup and tear down.

### 2. Requirements

##### AWS IAM Setup
- No one except you should be able to modify resources in your environment.

- Create IAM (Links to an external site.) users, and groups in all AWS (root, dev, prod) accounts.

##### Create Group
- Create csye6225-ta group for all teaching assistants.
- The group should have read-only access to AWS services and resources in your account. Search for the pre-defined read-only policy arn:aws:iam::aws:policy/ReadOnlyAccess (Links to an external site.) and attach it to the group.
##### Create Users
- Create a user account for all teaching assistants.
- Do not create one for the instructor.
- Use the first name as the username. Do not configure credentials for the users. Leave the default setting Autogenerated password checked and copy the generated password. AWS does not email autogenerated passwords. You need to manually send the email with the password.

#### AWS Networking Setup
Here is what you need to do for networking infrastructure setup:

- Create Virtual Private Cloud (VPC)Links to an external site..
- Create subnetsLinks to an external site. in your VPC. You must create 3 subnets, each in a different availability zone in the same region in the same VPC.
- Create an Internet GatewayLinks to an external site. resource and attach the Internet Gateway to the VPC.
- Create a public route tableLinks to an external site.. Attach all subnets created to the route table.
- Create a public route in the public route table created above with the destination CIDR block 0.0.0.0/0 and internet gateway created above as the target.

#### Infrastructure as Code with CloudFormation
- For this objective, you must complete the following tasks:

- Install and set up AWS command-line interface.
Create CloudFormation template csye6225-infra.json or csye6225-infra.yml that can be used to set up required networking resources.
Values should not be hard coded in your CloudFormation template.
You must be able to use the same CloudFormation template in the same AWS account and region to create multiple VPCs including all of its resources (listed in the “AWS Networking Setup” section) such as subnets, internet gateway, route table, etc.

### 3.Technology and external libraries Used
- AWS CLI
- YAML 
### 4. Prerequisites
- AWS CLI

### 5. Intstructions to create various profiles on AWS for AWS Cloud Formation

1. Sign-in to AWS (Dev/Demo alias Sub Account) through console login as root user.
2. Create a new group and attach admin access policy using IAM, next add a user to that group and save the credentials file
3. Set up MFA for the admin user
4. Repeat step 2 by signing in to AWS(Demo Account) 
5. Install CLI from https://docs.aws.amazon.com/cli/latest/userguide/awscli-install-linux.html
8. Now open your terminal and set up dev profile `aws configure --profile=dev` will create a dev profile
9. Enter the `Access key ID` , `Secret Access Key` from Dev account user credentials (From step 2)
10. Enter the `Default region name` (us-east-1) and `Output Format` ( `yml` )
11. `aws configure --profile=demo` will create a demo profile, and repeat the step number 9 to 10 with demo account credentials.
12. to check the details of the profiles set up run `cd .aws/` and then `cat config` or `cat credentials`

### 5. Instructions to Run application locally
1. Clone the repository

    ```
    $ git clone git@github.com:Raksha-Kagadalu/infrastructure.git
    ```

- Navigate to `infrastructure` folder to run the server


    ```
    $ cd infrastructure
    ```
- Set AWS `region` and `profile` to run your stack, by using below commands
    ```
    $ export AWS_PROFILE=demo
    $ export AWS_REGION=us-east-1 
    ```
- Run the below command to `build` your `stack` with `parameters` 
    ```
    $ aws cloudformation create-stack --stack-name demoTest1 --template-body file://csye6225-infra.yml --parameter ParameterKey=VpcCidrBlock,ParameterValue="10.0.0.0/16" ParameterKey=subnet1CidrBlock,ParameterValue="10.0.13.0/24" ParameterKey=subnet2CidrBlock,ParameterValue="10.0.12.0/24" ParameterKey=subnet3CidrBlock,ParameterValue="10.0.11.0/24" ParameterKey=AmiID,ParameterValue="--------"
    ```
- After addind s3, rds and dns
    ```
    $ aws cloudformation create-stack --stack-name demoTest2 --template-body file://csye6225-infra.yml --parameter ParameterKey=AmiID,ParameterValue="---" --capabilities CAPABILITY_NAMED_IAM

    ```

- Run the below command to `delete` your `stack` 
  
- To delete all objects from the bucket manually using the CLI before you delete the bucket you can use the following AWS CLI command that may work for removing all objects from the bucket. ``` aws s3 rm s3://bucket-name --recursive. ```
    ```
    $ aws cloudformation delete-stack --stack-name test2
    ```
- To view your stack , run the following command
    ```
    $ `aws --profile=dev ec2 describe-vpcs` .
    ```